<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Faturam Gold Premium</title>
<style>
body { font-family: 'Segoe UI', sans-serif; margin:0; padding:0; background:#fffbe6; color:#333; }
header { background:#ffd700; color:white; display:flex; align-items:center; padding:15px 30px; gap:15px; box-shadow: 0 4px 10px rgba(0,0,0,0.2);}
header img { height:50px; }
header h1 { margin:0; font-size:26px; font-weight:bold; text-shadow: 1px 1px 2px rgba(0,0,0,0.2);}
#controls, #miniToolbar, #rowControls { padding:15px; display:flex; gap:15px; background:#fff8dc; flex-wrap:wrap; border-radius:8px; margin:10px 20px; box-shadow: 0 3px 8px rgba(0,0,0,0.1);}
button, select, input[type=number]{ padding:8px 14px; border:none; border-radius:6px; background:#ffd700; color:#333; font-weight:bold; cursor:pointer; transition:0.2s; box-shadow: 0 2px 5px rgba(0,0,0,0.15);}
button:hover, select:hover, input:hover{ background:#ffcc00; box-shadow: 0 4px 8px rgba(0,0,0,0.25);}
table { border-collapse: collapse; width:calc(100% - 40px); margin:10px 20px; background:white; border-radius:10px; overflow:hidden; box-shadow:0 4px 15px rgba(0,0,0,0.2); user-select:text;}
th, td { border:1px solid #ffd700; min-width:100px; height:35px; text-align:center; padding:4px; position:relative;}
th { background:#fff2b2; font-weight:bold; }
input.cell-input { width:100%; height:100%; border:none; text-align:center; font-weight:bold; background:#fff; border-radius:4px; }
input.cell-input:focus { outline:2px solid #ffd700; background:#fffacd;}
.autocomplete-items { position:absolute; border:1px solid #ffd700; border-radius:6px; background-color:#fff8dc; max-height:150px; overflow-y:auto; z-index:100; box-shadow:0 4px 8px rgba(0,0,0,0.2);}
.autocomplete-item { padding:6px; cursor:pointer; transition:0.2s; }
.autocomplete-item:hover, .autocomplete-active { background-color:#ffeb99; }
footer { text-align:center; padding:12px; background:#ffd700; color:white; font-weight:bold; margin-top:20px; box-shadow:0 -3px 10px rgba(0,0,0,0.2);}
#shareOptions { display:none; position:absolute; background:#fff8dc; padding:10px; border:1px solid #ffd700; border-radius:6px; top:50px; left:10px; flex-direction:column; gap:5px; z-index:100;}
#shareOptions button { width:180px; }
</style>
</head>
<body>

<header>
    <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSRwNsJToes3vMaHCm2DHoiwJP4X7aZ-1m4Og&s" alt="Logo">
    <h1>Faturam Gold Premium</h1>
</header>

<div id="controls">
    <button onclick="newTable()">Yeni Oluştur</button>
    <button id="shareBtn">Projeyi Paylaş</button>
</div>

<div id="rowControls">
    <button onclick="addRow()">Satır Ekle</button>
    <button onclick="removeRow()">Satır Sil</button>
</div>

<div id="miniToolbar">
    <label>Font:
        <select id="fontSelect">
            <option>Arial</option>
            <option>Verdana</option>
            <option>Times New Roman</option>
            <option>Courier New</option>
        </select>
    </label>
    <label>Boyut:
        <input type="number" id="fontSize" value="14" min="8" max="36">
    </label>
    <button onclick="toggleBold()">B</button>
    <button onclick="toggleItalic()">I</button>
    <button onclick="toggleUnderline()">U</button>
    <label>Yazı Rengi:
        <input type="color" id="fontColor" value="#000000">
    </label>
    <label>Hücre Rengi:
        <input type="color" id="bgColor" value="#ffffff">
    </label>
</div>

<table id="excelTable"></table>

<div id="shareOptions">
    <button onclick="exportPDF()">PDF Olarak Paylaş</button>
    <button onclick="exportPNG()">PNG Olarak Paylaş</button>
    <button onclick="generateURL()">URL Oluştur</button>
</div>

<footer>Faturam Gold Premium</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script>
const { jsPDF } = window.jspdf;

let tableHeaders = ["Kullanıcı Adı", "Geçiş Tarihi", "Şehir", "Fiyat"];
let tableData = [];
let defaultRows = 10;
let defaultCols = tableHeaders.length;
let selectedCell = null;
let styleState = {bold:false, italic:false, underline:false};

const sehirler = [
  "Adana","Adıyaman","Afyonkarahisar","Ağrı","Aksaray","Amasya","Ankara","Antalya","Ardahan","Artvin","Aydın",
  "Balıkesir","Bartın","Batman","Bayburt","Bilecik","Bingöl","Bitlis","Bolu","Burdur","Bursa",
  "Çanakkale","Çankırı","Çorum","Denizli","Diyarbakır","Düzce","Edirne","Elazığ","Erzincan","Erzurum","Eskişehir",
  "Gaziantep","Giresun","Gümüşhane","Hakkari","Hatay","Iğdır","Isparta","İstanbul","İzmir","Kahramanmaraş","Karabük",
  "Karaman","Kars","Kastamonu","Kayseri","Kırıkkale","Kırklareli","Kırşehir","Kilis","Kocaeli","Konya","Kütahya",
  "Malatya","Manisa","Mardin","Mersin","Muğla","Muş","Nevşehir","Niğde","Ordu","Osmaniye","Rize","Sakarya",
  "Samsun","Siirt","Sinop","Sivas","Şanlıurfa","Şırnak","Tekirdağ","Tokat","Trabzon","Tunceli","Uşak","Van",
  "Yalova","Yozgat","Zonguldak"
];

// URL’den veri yükle
function loadFromURL(){
    const params = new URLSearchParams(window.location.search);
    if(params.has('data')){
        try{
            const decoded = JSON.parse(atob(decodeURIComponent(params.get('data'))));
            tableData = decoded;
            defaultRows = tableData.length;
            defaultCols = tableData[0] ? tableData[0].length : tableHeaders.length;
            renderTable();
        }catch(e){ console.log('URL veri hatası', e); newTable();}
    } else { newTable(); }
}

// Yeni tablo oluştur
function newTable(){ tableData = Array.from({length: defaultRows}, ()=>Array(defaultCols).fill('')); renderTable(); }

// Tablo render
function renderTable(){
    const table = document.getElementById('excelTable');
    table.innerHTML = '';

    let headerRow = table.insertRow();
    let thIndex = document.createElement('th'); thIndex.innerText = "#"; headerRow.appendChild(thIndex);
    tableHeaders.forEach(h=>{ let th = document.createElement('th'); th.innerText = h; headerRow.appendChild(th); });

    tableData.forEach((row,r)=>{
        let tr = table.insertRow();
        let tdIndex = tr.insertCell(); tdIndex.innerText = r+1;

        row.forEach((cell,c)=>{
            let td = tr.insertCell();
            let input = document.createElement('input');
            input.type='text'; input.className='cell-input'; input.value = cell;

            // Tarih otomatik
            input.addEventListener('input', ()=>{
                if (tableHeaders[c]==="Geçiş Tarihi") {
                    let val=input.value.replace(/\D/g,'');
                    if(val.length>2 && val.length<=4) val=val.slice(0,2)+'/'+val.slice(2);
                    else if(val.length>4) val=val.slice(0,2)+'/'+val.slice(2,4)+'/'+val.slice(4,8);
                    input.value=val;
                }
                tableData[r][c]=input.value;

                if (tableHeaders[c]==="Şehir") showAutocomplete(input,r,c);
            });

            input.addEventListener('focus', ()=>selectedCell=input);
            td.appendChild(input);
        });
    });

    makeResizable(table);
}

// Satır ekle/sil
function addRow(){ tableData.push(Array(defaultCols).fill('')); renderTable(); }
function removeRow(){ if(tableData.length>1){ tableData.pop(); renderTable(); }}

// Stil
function applyStyle(){ if(!selectedCell) return;
    selectedCell.style.fontFamily = document.getElementById('fontSelect').value;
    selectedCell.style.fontSize = document.getElementById('fontSize').value+'px';
    selectedCell.style.fontWeight = styleState.bold?'bold':'normal';
    selectedCell.style.fontStyle = styleState.italic?'italic':'normal';
    selectedCell.style.textDecoration = styleState.underline?'underline':'none';
    selectedCell.style.color = document.getElementById('fontColor').value;
    selectedCell.style.backgroundColor = document.getElementById('bgColor').value;
}

document.getElementById('fontSelect').addEventListener('change',applyStyle);
document.getElementById('fontSize').addEventListener('change',applyStyle);
document.getElementById('fontColor').addEventListener('change',applyStyle);
document.getElementById('bgColor').addEventListener('change',applyStyle);
function toggleBold(){ styleState.bold=!styleState.bold; applyStyle();}
function toggleItalic(){ styleState.italic=!styleState.italic; applyStyle();}
function toggleUnderline(){ styleState.underline=!styleState.underline; applyStyle();}

// Paylaşım
const shareBtn=document.getElementById('shareBtn');
const shareOptions=document.getElementById('shareOptions');
shareBtn.addEventListener('click',()=>{ shareOptions.style.display = shareOptions.style.display==='flex'?'none':'flex'; });

// PDF/PNG/URL fonksiyonları
function exportPDF(){ html2canvas(document.getElementById('excelTable')).then(canvas=>{ const imgData=canvas.toDataURL('image/png'); const pdf=new jsPDF('p','pt','a4'); const pageWidth=pdf.internal.pageSize.getWidth(); const imgWidth=pageWidth-40; const imgHeight=canvas.height*imgWidth/canvas.width; const logo=new Image(); logo.src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSRwNsJToes3vMaHCm2DHoiwJP4X7aZ-1m4Og&s"; logo.onload=()=>{ pdf.addImage(logo,'PNG',20,20,50,50); pdf.setFontSize(18); pdf.text("Faturam Gold Premium",80,50); pdf.addImage(imgData,'PNG',20,90,imgWidth,imgHeight); pdf.save("FaturamGold_Proje.pdf"); } }); }
function exportPNG(){ html2canvas(document.getElementById('excelTable')).then(canvas=>{ const link=document.createElement('a'); link.download='FaturamGold_Proje.png'; link.href=canvas.toDataURL(); link.click(); }); }
function generateURL(){ const dataStr=encodeURIComponent(btoa(JSON.stringify(tableData))); const base=window.location.href.split('?')[0]; const url=`${base}?data=${dataStr}`; prompt("Paylaşabileceğiniz link:",url); }

// Sütun genişletme
function makeResizable(table){ table.querySelectorAll('th').forEach((th,index)=>{ if(index===0) return; th.style.position='relative'; const grip=document.createElement('div'); grip.style.width='5px'; grip.style.position='absolute'; grip.style.top='0'; grip.style.right='0'; grip.style.bottom='0'; grip.style.cursor='col-resize'; th.appendChild(grip); let startX,startWidth; grip.addEventListener('mousedown',(e)=>{ startX=e.pageX; startWidth=th.offsetWidth; document.addEventListener('mousemove',onMouseMove); document.addEventListener('mouseup',onMouseUp); }); function onMouseMove(e){ const diff=e.pageX-startX; const newWidth=startWidth+diff; th.style.width=newWidth+'px'; table.querySelectorAll('tr').forEach(tr=>{ if(tr.cells[index]) tr.cells[index].style.width=newWidth+'px'; }); } function onMouseUp(){ document.removeEventListener('mousemove',onMouseMove); document.removeEventListener('mouseup',onMouseUp); } }); }

// Şehir autocomplete klavye
let currentFocus=-1;
function showAutocomplete(input,row,col){
    closeAutocomplete();
    const val=input.value.toLowerCase();
    if(!val) return;
    const matches=sehirler.filter(s=>s.toLowerCase().startsWith(val));
    if(matches.length===0) return;

    const list=document.createElement('div'); list.classList.add('autocomplete-items'); input.parentNode.appendChild(list);

    matches.forEach(match=>{
        const item=document.createElement('div'); item.classList.add('autocomplete-item'); item.innerText=match;
        item.addEventListener('click',()=>{ input.value=match; tableData[row][col]=match; closeAutocomplete(); });
        list.appendChild(item);
    });

    input.addEventListener('keydown', function(e){
        const items=list.getElementsByClassName('autocomplete-item');
        if(e.key==='ArrowDown'){ currentFocus++; addActive(items); e.preventDefault(); }
        else if(e.key==='ArrowUp'){ currentFocus--; addActive(items); e.preventDefault(); }
        else if(e.key==='Enter'){ e.preventDefault(); if(currentFocus>-1 && items[currentFocus]){ items[currentFocus].click(); } }
    });
}

function addActive(items){ if(!items) return; removeActive(items); if(currentFocus>=items.length) currentFocus=0; if(currentFocus<0) currentFocus=items.length-1; items[currentFocus].classList.add('autocomplete-active'); }
function removeActive(items){ for(let i=0;i<items.length;i++) items[i].classList.remove('autocomplete-active'); }
function closeAutocomplete(){ const items=document.getElementsByClassName('autocomplete-items'); for(let i=0;i<items.length;i++){ if(items[i]) items[i].parentNode.removeChild(items[i]); } currentFocus=-1; }

window.onload = loadFromURL;
document.addEventListener('click', function(e){ closeAutocomplete(); });
</script>
</body>
</html>
